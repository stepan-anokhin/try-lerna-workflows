name: Test AWS access
on:
  push:
    branches:
      - master

jobs:
  test-aws:
    runs-on: ubuntu-latest
    steps:
      - name: Try AWS CLI
        run: |
          which aws
          aws s3 help | cat
      - name: Test Docker
        if: github.ref_name == 'master'
        run: |
          export GHCR_TAG="node:14"
          export ON_PREMISE_TAG="${{ github.event.repository.name }}-${{ github.ref_name }}:latest"
          export IMAGE_TAR="${{ github.event.repository.name }}-${{ github.ref_name }}.tar"
          
          docker tag "$GHCR_TAG" "$ON_PREMISE_TAG"
          docker save "$ON_PREMISE_TAG" -o "$IMAGE_TAR"
          docker image ls --all
          ls -l